<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ken & Kelly Avatar Inventory</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 40px;
        }
        
        .inventory-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 40px;
        }
        
        .avatar-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .avatar-section h2 {
            margin-top: 0;
            color: #3498db;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .ken h2 {
            color: #2980b9;
            border-color: #2980b9;
        }
        
        .kelly h2 {
            color: #e74c3c;
            border-color: #e74c3c;
        }
        
        .category {
            margin-bottom: 30px;
        }
        
        .category h3 {
            color: #555;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .asset-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .asset-item {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .asset-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .asset-item img {
            width: 100%;
            height: auto;
            border-radius: 6px;
            margin-bottom: 8px;
            background: white;
            padding: 4px;
        }
        
        .asset-name {
            font-size: 0.9em;
            color: #666;
            word-break: break-word;
            margin-bottom: 5px;
        }
        
        .asset-status {
            font-size: 0.8em;
            padding: 2px 6px;
            border-radius: 3px;
            display: inline-block;
        }
        
        .status-available {
            background: #2ecc71;
            color: white;
        }
        
        .status-missing {
            background: #e74c3c;
            color: white;
        }
        
        .stats {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .stats h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f8f8f8;
            border-radius: 8px;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
        }
        
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        
        .r2-status {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .frame-sequence {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background: #f9f9f9;
        }
        
        .frame-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }
        
        .frame-item {
            font-size: 0.85em;
            padding: 5px;
            background: white;
            border-radius: 4px;
            text-align: center;
            color: #666;
        }

        .filter-controls {
            margin-bottom: 20px;
            text-align: center;
        }

        .filter-btn {
            padding: 8px 16px;
            margin: 0 5px;
            border: none;
            border-radius: 5px;
            background: #3498db;
            color: white;
            cursor: pointer;
            transition: background 0.3s;
        }

        .filter-btn:hover {
            background: #2980b9;
        }

        .filter-btn.active {
            background: #2c3e50;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé≠ Ken & Kelly Avatar Inventory</h1>
        
        <div class="stats">
            <h3>üìä Inventory Summary</h3>
            <div class="stat-grid" id="stats-grid">
                <!-- Stats will be populated by JavaScript -->
            </div>
        </div>
        
        <div class="r2-status">
            <strong>‚ÑπÔ∏è Cloudflare R2 Status:</strong> 
            <span id="r2-status">Checking connection...</span>
        </div>

        <div class="filter-controls">
            <button class="filter-btn active" onclick="showAll()">Show All</button>
            <button class="filter-btn" onclick="showAvailable()">Available Only</button>
            <button class="filter-btn" onclick="showMissing()">Missing Only</button>
        </div>
        
        <div class="inventory-grid">
            <div class="avatar-section kelly">
                <h2>üë© Kelly Avatar Assets</h2>
                <div id="kelly-inventory"></div>
            </div>
            
            <div class="avatar-section ken">
                <h2>üë® Ken Avatar Assets</h2>
                <div id="ken-inventory"></div>
            </div>
        </div>
    </div>

    <script>
        // Avatar inventory configuration
        const INVENTORY = {
            kelly: {
                'Base States': [
                    'kelly_neutral_default.png'
                ],
                'Emotional Expressions': [
                    'emotional-expressions/kelly_concerned_thinking.png',
                    'emotional-expressions/kelly_happy_celebrating.png'
                ],
                'Lesson Sequence': [
                    'lesson-sequence/kelly_question_curious.png',
                    'lesson-sequence/kelly_teaching_explaining.png'
                ],
                'Mouth Phonemes (2D)': [
                    '2d/mouth_A_EMPHASIS.png',
                    '2d/mouth_A_EXCITED.png',
                    '2d/mouth_A_HAPPY.png',
                    '2d/mouth_A_QUESTION.png',
                    '2d/mouth_A_SERIOUS.png',
                    '2d/mouth_A_TEACH.png',
                    '2d/mouth_AW.png',
                    '2d/mouth_AY.png',
                    '2d/mouth_CH.png',
                    '2d/mouth_E_EMPHASIS.png',
                    '2d/mouth_E_EXCITED.png',
                    '2d/mouth_E_HAPPY.png',
                    '2d/mouth_E_QUESTION.png',
                    '2d/mouth_E_SERIOUS.png',
                    '2d/mouth_E_TEACH.png',
                    '2d/mouth_H.png',
                    '2d/mouth_I_EMPHASIS.png',
                    '2d/mouth_I_EXCITED.png',
                    '2d/mouth_I_HAPPY.png',
                    '2d/mouth_I_QUESTION.png',
                    '2d/mouth_I_SERIOUS.png',
                    '2d/mouth_I_TEACH.png',
                    '2d/mouth_L.png',
                    '2d/mouth_NG.png',
                    '2d/mouth_OO.png',
                    '2d/mouth_OY.png',
                    '2d/mouth_SH.png',
                    '2d/mouth_UH.png',
                    '2d/mouth_Y.png',
                    '2d/mouth_ZH.png'
                ],
                'Visemes (Flat)': [
                    '2d/visemes_flat/kelly_A.png',
                    '2d/visemes_flat/kelly_DNTL.png',
                    '2d/visemes_flat/kelly_E.png',
                    '2d/visemes_flat/kelly_FV.png',
                    '2d/visemes_flat/kelly_I.png',
                    '2d/visemes_flat/kelly_KG.png',
                    '2d/visemes_flat/kelly_MBP.png',
                    '2d/visemes_flat/kelly_O.png',
                    '2d/visemes_flat/kelly_R.png',
                    '2d/visemes_flat/kelly_REST.png',
                    '2d/visemes_flat/kelly_S.png',
                    '2d/visemes_flat/kelly_TH.png',
                    '2d/visemes_flat/kelly_WQ.png'
                ],
                'Frame Sequence': {
                    total: 366,
                    pattern: '2d/full/kelly_frame_{0000-0364}.png',
                    special: ['2d/full/kelly_O.png']
                }
            },
            ken: {
                'Base States': [
                    'ken_neutral_default.png'
                ],
                'Emotional Expressions': [
                    'emotional-expressions/ken_concerned_thinking.png',
                    'emotional-expressions/ken_happy_celebrating.png'
                ],
                'Lesson Sequence': [
                    'lesson-sequence/ken_question_curious.png',
                    'lesson-sequence/ken_teaching_explaining.png'
                ],
                'Mouth Phonemes (2D)': [
                    '2d/mouth_A_EMPHASIS.png',
                    '2d/mouth_A_EXCITED.png',
                    '2d/mouth_A_HAPPY.png',
                    '2d/mouth_A_QUESTION.png',
                    '2d/mouth_A_SERIOUS.png',
                    '2d/mouth_A_TEACH.png',
                    '2d/mouth_AW.png',
                    '2d/mouth_AY.png',
                    '2d/mouth_CH.png',
                    '2d/mouth_E_EMPHASIS.png',
                    '2d/mouth_E_EXCITED.png',
                    '2d/mouth_E_HAPPY.png',
                    '2d/mouth_E_QUESTION.png',
                    '2d/mouth_E_SERIOUS.png',
                    '2d/mouth_E_TEACH.png',
                    '2d/mouth_H.png',
                    '2d/mouth_I_EMPHASIS.png',
                    '2d/mouth_I_EXCITED.png',
                    '2d/mouth_I_HAPPY.png',
                    '2d/mouth_I_QUESTION.png',
                    '2d/mouth_I_SERIOUS.png',
                    '2d/mouth_I_TEACH.png',
                    '2d/mouth_L.png',
                    '2d/mouth_NG.png',
                    '2d/mouth_OO.png',
                    '2d/mouth_OY.png',
                    '2d/mouth_SH.png',
                    '2d/mouth_UH.png',
                    '2d/mouth_Y.png',
                    '2d/mouth_ZH.png'
                ],
                'Visemes (Flat)': [
                    '2d/visemes_flat/ken_A.png',
                    '2d/visemes_flat/ken_DNTL.png',
                    '2d/visemes_flat/ken_E.png',
                    '2d/visemes_flat/ken_FV.png',
                    '2d/visemes_flat/ken_I.png',
                    '2d/visemes_flat/ken_KG.png',
                    '2d/visemes_flat/ken_MBP.png',
                    '2d/visemes_flat/ken_O.png',
                    '2d/visemes_flat/ken_R.png',
                    '2d/visemes_flat/ken_REST.png',
                    '2d/visemes_flat/ken_S.png',
                    '2d/visemes_flat/ken_TH.png',
                    '2d/visemes_flat/ken_WQ.png'
                ],
                'Tone Specific': [
                    'tone-specific/fun/.placeholder',
                    'tone-specific/grandmother/.placeholder',
                    'tone-specific/neutral/.placeholder'
                ],
                'Frame Sequence': {
                    total: 348,
                    pattern: '2d/full/ken_frame_{0000-0346}.png',
                    special: ['2d/full/ken_O.png']
                }
            }
        };

        const BASE_URL = '/assets/avatars';
        const R2_BASE = 'https://ilearnhow.com/assets/avatars';
        
        let stats = {
            kelly: { total: 0, available: 0, missing: 0 },
            ken: { total: 0, available: 0, missing: 0 }
        };

        async function checkAssetAvailability(path) {
            try {
                const response = await fetch(`${BASE_URL}/${path}`, { method: 'HEAD' });
                return response.ok;
            } catch {
                return false;
            }
        }

        async function checkR2Status() {
            const statusEl = document.getElementById('r2-status');
            try {
                // Check a known asset to test R2 connectivity
                const testAsset = `${R2_BASE}/kelly/base-states/kelly_neutral_default.png`;
                const response = await fetch(testAsset, { method: 'HEAD' });
                
                if (response.ok) {
                    statusEl.textContent = '‚úÖ Connected to Cloudflare R2';
                    statusEl.style.color = '#27ae60';
                } else {
                    statusEl.textContent = '‚ö†Ô∏è R2 not configured or assets not uploaded';
                    statusEl.style.color = '#e67e22';
                }
            } catch (error) {
                statusEl.textContent = '‚ùå Unable to connect to R2 (CORS or network issue)';
                statusEl.style.color = '#e74c3c';
            }
        }

        function renderAssetItem(avatarName, assetPath, available) {
            const fileName = assetPath.split('/').pop();
            const cleanName = fileName.replace('.png', '').replace(/_/g, ' ');
            
            stats[avatarName].total++;
            if (available) {
                stats[avatarName].available++;
            } else {
                stats[avatarName].missing++;
            }
            
            return `
                <div class="asset-item ${available ? 'available' : 'missing'}" data-status="${available ? 'available' : 'missing'}">
                    <img src="${BASE_URL}/${avatarName}/${assetPath}" 
                         alt="${cleanName}" 
                         onerror="this.style.display='none'"
                         loading="lazy">
                    <div class="asset-name">${cleanName}</div>
                    <span class="asset-status ${available ? 'status-available' : 'status-missing'}">
                        ${available ? 'Available' : 'Missing'}
                    </span>
                </div>
            `;
        }

        function renderFrameSequence(avatarName, frameData) {
            const frames = [];
            const maxFrame = avatarName === 'kelly' ? 364 : 346;
            
            for (let i = 0; i <= maxFrame; i++) {
                const frameNum = String(i).padStart(4, '0');
                frames.push(`frame_${frameNum}`);
            }
            
            if (frameData.special) {
                frameData.special.forEach(special => {
                    frames.push(special.split('/').pop().replace('.png', ''));
                });
            }
            
            return `
                <div class="frame-sequence">
                    <h4>üì∏ Frame Sequence (${frameData.total} frames)</h4>
                    <div class="frame-list">
                        ${frames.map(frame => `<div class="frame-item">${frame}</div>`).join('')}
                    </div>
                </div>
            `;
        }

        async function renderInventory(avatarName) {
            const container = document.getElementById(`${avatarName}-inventory`);
            const inventory = INVENTORY[avatarName];
            let html = '';
            
            for (const [category, assets] of Object.entries(inventory)) {
                if (category === 'Frame Sequence') {
                    html += `<div class="category">${renderFrameSequence(avatarName, assets)}</div>`;
                    stats[avatarName].total += assets.total;
                    stats[avatarName].available += assets.total; // Assume all frames exist
                } else {
                    html += `<div class="category">`;
                    html += `<h3>${category}</h3>`;
                    html += `<div class="asset-grid">`;
                    
                    const assetItems = await Promise.all(
                        assets.map(async (assetPath) => {
                            const available = await checkAssetAvailability(`${avatarName}/${assetPath}`);
                            return renderAssetItem(avatarName, assetPath, available);
                        })
                    );
                    
                    html += assetItems.join('');
                    html += `</div></div>`;
                }
            }
            
            container.innerHTML = html;
        }

        function updateStats() {
            const statsGrid = document.getElementById('stats-grid');
            const totalAssets = stats.kelly.total + stats.ken.total;
            const totalAvailable = stats.kelly.available + stats.ken.available;
            const totalMissing = stats.kelly.missing + stats.ken.missing;
            
            statsGrid.innerHTML = `
                <div class="stat-item">
                    <div class="stat-number">${totalAssets}</div>
                    <div class="stat-label">Total Assets</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" style="color: #27ae60">${totalAvailable}</div>
                    <div class="stat-label">Available</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" style="color: #e74c3c">${totalMissing}</div>
                    <div class="stat-label">Missing</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${stats.kelly.total}</div>
                    <div class="stat-label">Kelly Assets</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${stats.ken.total}</div>
                    <div class="stat-label">Ken Assets</div>
                </div>
            `;
        }

        // Filter functions
        function showAll() {
            document.querySelectorAll('.asset-item').forEach(el => el.style.display = 'block');
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function showAvailable() {
            document.querySelectorAll('.asset-item').forEach(el => {
                el.style.display = el.dataset.status === 'available' ? 'block' : 'none';
            });
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function showMissing() {
            document.querySelectorAll('.asset-item').forEach(el => {
                el.style.display = el.dataset.status === 'missing' ? 'block' : 'none';
            });
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Initialize on page load
        async function initialize() {
            await checkR2Status();
            await Promise.all([
                renderInventory('kelly'),
                renderInventory('ken')
            ]);
            updateStats();
        }

        initialize();
    </script>
</body>
</html>
